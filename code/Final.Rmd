---
title: "Final"
author: "Adam Guerra, Luke Todd, Riley Zamora"
date: "2023-06-11"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    toc_depth: 5
    theme: sandstone
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Loading Packages
library(tidyverse)
library(here)
library(janitor)
library(ggeffects)
library(performance)
library(naniar) 
library(flextable) 
library(car)
library(broom)
library(corrplot)
library(AICcmodavg)
library(MASS)
library(lme4)
library(MuMIn)
library(lmtest)
library(DHARMa)
library(ggeffects)
library(lmtest)
library(skimr)
library(GGally)
library(glmmTMB)
library(broom.mixed)
```


## Problem 1


### Introduction


### Methods

##### Loading Data
```{r, warning = FALSE}
# loading data
kang_seed <- read.table(here("data/sev208_kratseedbank_20120213.txt"), sep=',', header = TRUE) |> 
             mutate(mnd = as.factor(mnd))
```

##### Missing Data
```{r}
gg_miss_var(kang_seed)
```

##### Skim
```{r}
skim(kang_seed)
```

##### Visualize Data
```{r}
# visualize counts
ggplot(kang_seed, aes(x = seeds)) +
  geom_histogram(bins = 17)

```

```{r}
#visualize using box plot
ggplot(data = kang_seed, aes(x = mnd, y = seeds)) +
  geom_boxplot() +
  labs(x = "Mound Number", y = "NUmber of Seeds", title = "Boxplot of Seeds Found at Different Mounds") +
  theme_bw()
```

**Question: How does total seed number differ between kangaroo rat mound locations?**

##### Assumption Checks
```{r}
#
```


### Results



---

## Problem 2


### Introduction



### Methods


##### Loading Data
```{r}
# loading data
shrub_raw <- read.csv(here("data/shrubstudy_seed.csv"))

shrub_seed <- shrub_raw |>
              dplyr::select(treatment, species, total_inf = total_nr_infl, 
                      num_seeds = nr_seeds, shrub_num) |>
              mutate(treatment = as.factor(treatment))
```

##### Missing Data
```{r}
# visualize missing data
gg_miss_var(shrub_seed)
```

##### Skim
```{r}
skim(shrub_seed)
```

##### Subset Dataset
```{r}
# filter out missing data
shrub_seed_sub <- shrub_seed |> 
                  drop_na(num_seeds) 
```

##### Histogram of Counts
```{r}
ggplot(shrub_seed_sub, aes(x = num_seeds)) +
  geom_histogram(bins = 17)
```

##### Correlation Plot
```{r}
# calc Pearson's r for numerical values
shrub_seed_sub_cor <- shrub_seed_sub |> 
                      dplyr::select(3:4) |> 
                      cor(method = "pearson")

# plot correlation values
corrplot(shrub_seed_sub_cor,
         method = "ellipse",
         addCoef.col = "black")
```
    
##### Variable Relationships
```{r, warning=FALSE, message=FALSE}
shrub_seed_sub |> 
  dplyr::select(!num_seeds) |> 
  ggpairs()
```

**Question: How does seed count vary with plot type (shrub or open), plant species, and total number of inflorescences? Is there a simpler model that explains seed count, and if so, what is it?**

##### Build Models
```{r, message=FALSE, warning=FALSE}
# linear model, we know this is wrong
shrub_model1 <- lm(num_seeds ~ treatment + species + total_inf, data = shrub_seed_sub)

# generalized linear model with Poisson distribution
shrub_model2 <- glm(num_seeds ~ treatment + species + total_inf, data = shrub_seed_sub, family = "poisson")

# generalized linear model with negative binomial distribution
shrub_model3 <- glmmTMB(num_seeds ~ treatment + species + total_inf, data = shrub_seed_sub, family = "nbinom2")

# generalized linear model with Poisson distribution and random effect of treatment
shrub_model4 <- glmmTMB(num_seeds ~ treatment + species + total_inf + (1|shrub_num), 
                          data = shrub_seed_sub, family = "poisson")

# generalized linear model with negative binomial distribution and random effect of treatment
shrub_model5 <- glmmTMB(num_seeds ~ treatment + species + total_inf + (1|shrub_num), 
                      data = shrub_seed_sub, family = "nbinom2")
```

Because we are looking at count data, we know that the data is discrete and only has a lower bound. Knowing this, we built a couple different models using the Poisson and Negative Binomial distribution.


```{r}
# check diagnostics
plot(simulateResiduals(shrub_model1)) # bad
```
```{r}
plot(simulateResiduals(shrub_model2)) # bad
```
```{r}
plot(simulateResiduals(shrub_model3)) # ok?
```
```{r}
plot(simulateResiduals(shrub_model4)) # bad
```
```{r}
plot(simulateResiduals(shrub_model5)) # ok?
```

##### Which distribution to use?
```{r}
MuMIn::model.sel(shrub_model1, shrub_model2, shrub_model3, shrub_model4, shrub_model5)
```

##### Model Summary
```{r}
# model object
shrub_model3
```
```{r}
# summary
summary(shrub_model3)
```

```{r, warning=FALSE, message = FALSE}
# confidence intervals
confint(shrub_model3)
```
```{r, warning = FALSE}
# adjusted R2
r.squaredGLMM(shrub_model3)
```
```{r}
# model object in table
shrub_model3 |> 
  as_flextable()
```

##### Visualizing
```{r}

```



### Results
































